<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Xt (kcas.Kcas.Xt)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">kcas</a> &#x00BB; <a href="../index.html">Kcas</a> &#x00BB; Xt</nav><header class="odoc-preamble"><h1>Module <code><span>Kcas.Xt</span></code></h1><p>Explicit transaction log passing on shared memory locations.</p></header><nav class="odoc-toc"><ul><li><a href="#recording-accesses">Recording accesses</a></li><li><a href="#performing-accesses">Performing accesses</a></li><li><a href="#conversions">Conversions</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'x t</span></span></code></div><div class="spec-doc"><p>Type of an explicit transaction log on shared memory locations.</p><p>Note that a transaction log itself is not domain-safe and should generally only be used by a single domain. If a new domain is spawned inside a function recording shared memory accesses to a log and the new domain also records accesses to the log it may become inconsistent.</p></div></div><h2 id="recording-accesses"><a href="#recording-accesses" class="anchor"></a>Recording accesses</h2><p>Accesses of shared memory locations using an explicit transaction log first ensure that the initial value of the shared memory location is recorded in the log and then act on the current value of the shared memory location as recorded in the log.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>get ~xt r</code> returns the current value of the shared memory location <code>r</code> in the explicit transaction log <code>xt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set ~xt r v</code> records the current value of the shared memory location <code>r</code> to be the given value <code>v</code> in the explicit transaction log <code>xt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>update ~xt r f</code> is equivalent to <code>let x = get ~xt r in set ~xt r (f x);
      x</code> with the limitation that <code>f</code> must not and is not allowed to record accesses to the transaction log.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-modify"><a href="#val-modify" class="anchor"></a><code><span><span class="keyword">val</span> modify : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>modify ~xt r f</code> is equivalent to <code>let x = get ~xt r in set ~xt r (f x)</code> with the limitation that <code>f</code> must not and is not allowed to record accesses to the transaction log.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exchange"><a href="#val-exchange" class="anchor"></a><code><span><span class="keyword">val</span> exchange : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>exchange ~xt r v</code> is equivalent to <code>update ~xt r (fun _ -&gt; v)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fetch_and_add"><a href="#val-fetch_and_add" class="anchor"></a><code><span><span class="keyword">val</span> fetch_and_add : <span>xt:<span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>fetch_and_add ~xt r n</code> is equivalent to <code>update ~xt r ((+) n)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-incr"><a href="#val-incr" class="anchor"></a><code><span><span class="keyword">val</span> incr : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>incr ~xt r</code> is equivalent to <code>fetch_and_add ~xt r 1 |&gt; ignore</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decr"><a href="#val-decr" class="anchor"></a><code><span><span class="keyword">val</span> decr : <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="../Loc/index.html#type-t">Loc.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>decr ~xt r</code> is equivalent to <code>fetch_and_add ~xt r (-1) |&gt; ignore</code>.</p></div></div><h2 id="performing-accesses"><a href="#performing-accesses" class="anchor"></a>Performing accesses</h2><div class="odoc-spec"><div class="spec type anchored" id="type-tx"><a href="#type-tx" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a tx</span></span><span> = </span><span>{</span></code><ol><li id="type-tx.tx" class="def record field anchored"><a href="#type-tx.tx" class="anchor"></a><code><span>tx : 'x. <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Type of a transaction function that is polymorphic with respect to an explicit transaction log. The universal quantification helps to ensure that the transaction log cannot accidentally escape.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-call"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : <span><span><span class="type-var">'a</span> <a href="#type-tx">tx</a></span> <span class="arrow">&#45;&gt;</span></span> <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>call ~xt tx</code> is equivalent to <code>tx.Xt.tx ~xt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attempt"><a href="#val-attempt" class="anchor"></a><code><span><span class="keyword">val</span> attempt : <span>?mode:<a href="../Mode/index.html#type-t">Mode.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-tx">tx</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>attempt tx</code> attempts to atomically perform the transaction over shared memory locations recorded by calling <code>tx</code> with a fresh explicit transaction log. If used in <a href="../Mode/index.html#val-obstruction_free"><code>Mode.obstruction_free</code></a> may raise <a href="../Mode/index.html#exception-Interference"><code>Mode.Interference</code></a>. Otherwise either raises <code>Exit</code> on failure to commit the transaction or returns the result of the transaction. The default for <code>attempt</code> is <a href="../Mode/index.html#val-lock_free"><code>Mode.lock_free</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commit"><a href="#val-commit" class="anchor"></a><code><span><span class="keyword">val</span> commit : <span>?backoff:<a href="../Backoff/index.html#type-t">Backoff.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?mode:<a href="../Mode/index.html#type-t">Mode.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-tx">tx</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>commit tx</code> repeats <code>attempt tx</code> until it does not raise <code>Exit</code> or <a href="../Mode/index.html#exception-Interference"><code>Mode.Interference</code></a> and then either returns or raises whatever attempt returned or raised.</p><p>The default for <code>commit</code> is <a href="../Mode/index.html#val-obstruction_free"><code>Mode.obstruction_free</code></a>. However, after enough attempts have failed during the verification step, <code>commit</code> switches to <a href="../Mode/index.html#val-lock_free"><code>Mode.lock_free</code></a>.</p><p>Note that, aside from using exponential backoff to reduce contention, the transaction mechanism has no way to intelligently wait until shared memory locations are modified by other domains.</p></div></div><h2 id="conversions"><a href="#conversions" class="anchor"></a>Conversions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-of_tx"><a href="#val-of_tx" class="anchor"></a><code><span><span class="keyword">val</span> of_tx : <span><span><span class="type-var">'a</span> <a href="../Tx/index.html#type-t">Tx.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>xt:<span><span class="type-var">'x</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>of_tx tx</code> converts the given <a href="../Tx/index.html"><code>Tx</code></a> transaction <code>tx</code> to an explicit log passing function.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_tx"><a href="#val-to_tx" class="anchor"></a><code><span><span class="keyword">val</span> to_tx : <span><span><span class="type-var">'a</span> <a href="#type-tx">tx</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../Tx/index.html#type-t">Tx.t</a></span></span></code></div><div class="spec-doc"><p><code>to_tx tx</code> converts the given explicit log passing function <code>tx</code> to a <a href="../Tx/index.html"><code>Tx</code></a> transaction.</p></div></div></div></body></html>